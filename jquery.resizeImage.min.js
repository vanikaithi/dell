!function(X){"use strict";var o={black:"rgba(20, 20, 20, .6)",white:"rgba(250, 250, 250, .6)"},Y=!1,M=!1;X.hasOwnProperty("fn")?X.fn.resizeImage=function(t,z){var i,H=X.extend({image:!1,imgFormat:"auto",device:"all",circleCrop:!1,zoomable:!0,zoomMax:2,outBoundColor:"black",btnDoneAttr:".R-container .R-btn-done"},t);X(this).html((e=H,'<div class="R-container"><div class="R-cover"></div><div class="R-adapter"><canvas class="statCanvas"></canvas><div class="R-scaler'+(e.circleCrop?" circle":"")+'"><canvas class="dynaCanvas"></canvas><div class="R-col-1"></div><div class="R-col-2"></div><div class="R-col-3"></div><div class="R-raw-1"></div><div class="R-raw-2"></div><div class="R-raw-3"></div><div class="R-corner-lt" data-action="lt-resize"></div><div class="R-corner-rt" data-action="rt-resize"></div><div class="R-corner-rb" data-action="rb-resize"></div><div class="R-corner-lb" data-action="lb-resize"></div><div class="R-side-left" data-action="l-resize"></div><div class="R-side-top" data-action="t-resize"></div><div class="R-side-right" data-action="r-resize"></div><div class="R-side-bottom" data-action="b-resize"></div></div></div></div>'));var e;var y=new Image,h=(X(this),X(".R-container")),k=X(".R-adapter"),C=X(".R-scaler"),W=X(".R-cover"),E=X('[class^="R-side-"], [class^="R-corner-"]');H.image?i="string"!=typeof H.image?window.URL.createObjectURL(H.image):H.image:h.html('<div class="R-error">Configuration Error: Set the image URL or blob image file as options.image </div>');y.onload=function(){!function(t,i,e){var h,o={width:80,height:80};/x/.test(i.imgFormat)?(h=i.imgFormat.split("x"),o.width=parseInt(h[0]),o.height=parseInt(h[1]),M=!(Y=!0),X(".R-container [data-action]").hide()):/[1-9]\/[1-9]/.test(i.imgFormat)?(h=i.imgFormat.split("/"),o.width*=parseInt(h[0]),o.height*=parseInt(h[1]),!(M=!(Y=!1)),X(".R-container [data-action]").show(),X(".R-container [class^=R-side-]").hide()):(!(M=Y=!1),X(".R-container [data-action]").show());t.width>=o.width&&t.height>=o.height?e({width:t.width,height:t.height,minWidth:o.width,minHeight:o.height,ratio:parseInt(o.width)/parseInt(o.height)}):X(".R-container").html('<div class="R-error">This image is smaller than '+o.width+"x"+o.height+"</div>")}(y,H,function(v){var x=document.querySelector(".statCanvas"),R=document.querySelector(".dynaCanvas"),b=x.getContext("2d"),I=R.getContext("2d");I.imageSmoothingEnabled=!0,I.imageSmoothingQuality="high",x.width=h.width(),x.height=h.height(),function(t,i,e){var h=t.width,o=t.height,a=t.width>=t.height,n=0,s=0;a?t.width>i.width()?(o*=i.width()/h,h=i.width(),n=(i.height()-o)/2):(h*=i.height()/o,o=i.height(),s=(i.width()-h)/2):t.height>i.height()&&(h*=i.height()/o,o=i.height(),s=(i.width()-h)/2);e({width:h,height:o,left:s,top:n,HzImage:t.width!=t.height?t.width>t.height:null})}(v,h,function(u){W.css({left:u.left+"px",top:u.top+"px",right:u.left+"px",bottom:u.top+"px",background:o[o.hasOwnProperty(H.outBoundColor)?H.outBoundColor:"black"]}),function(t,i,e){var h,o,a=i.width,n=i.height;1!=t.ratio?t.ratio<1?(h=a<n?a/n>t.minWidth/t.minHeight?t.minWidth*n/t.minHeight:a:t.minWidth<t.minHeight?t.minWidth*n/t.minHeight:a,o=a<n?a/n>t.minWidth/t.minHeight?n:t.minHeight*a/t.minWidth:t.minWidth<t.minHeight?n:a*(t.minHeight/n)):(h=a<n?a:a/n>t.minWidth/t.minHeight?t.minWidth*n/t.minHeight:a,o=a<n?t.minHeight*a/t.minWidth:a/n>t.minWidth/t.minHeight?n:a*(t.minHeight/n)):h=o=a<n?a:n;e({width:h,height:o,left:i.HzImage?(a-h)/2:0,top:i.HzImage?0:(n-o)/2})}(v,u,function(t){C.css({width:R.width=t.width-4,height:R.height=t.height-4,left:t.left+"px",top:t.top+"px"});var s=u.width-R.width,d=u.height-R.height,g=0+u.width,r=0+u.height,c=C.width()/2,p=C.height()/2,i=!1,l={width:u.width,height:u.height,left:0,top:0},e={},h={},o=!0,w=0,m=1;function a(t,i,e){var h=(e?t.originalEvent.touches[0].clientX:t.pageX)-i.x,o=(e?t.originalEvent.touches[0].clientY:t.pageY)-i.y,a=0<=h&&h<=s-4,n=0<=o&&o<=d-4;a?C.css("left",h+"px"):h=C.position().left,n?C.css("top",o+"px"):o=C.position().top,1<m&&(b.clearRect(0,0,l.width,l.height),i.ox=Math.floor(t.pageX-W.offset().left),i.oy=Math.floor(t.pageY-W.offset().top),b.drawImage(y,-i.ox*w,-i.oy*w,l.width,l.height)),I.drawImage(x,h+2,o+2,C.width(),C.height(),0,0,C.width(),C.height())}function n(t,i,e){var h,o,a=(e?t.originalEvent.touches[0].pageX:t.pageX)-C.offset().left,n=(e?t.originalEvent.touches[0].pageY:t.pageY)-C.offset().top,s=(e?t.originalEvent.touches[0].clientX:t.clientX)-k.offset().left,d=(e?t.originalEvent.touches[0].clientY:t.clientY)-k.offset().top;switch(i.t.data("action")){case"l-resize":h=C.width()-a,0<=s&&c<h&&(C.css({width:h+"px",left:s+"px"}),R.width=h,I.drawImage(x,s+2,C.position().top+2,h,C.height(),0,0,h,C.height()));break;case"r-resize":h=a,s<=g-4&&c<h&&(C.css("width",h+"px"),R.width=h,I.drawImage(x,C.position().left+2,C.position().top+2,h,C.height(),0,0,h,C.height()));break;case"t-resize":o=C.height()-n,0<=d&&p<o&&(C.css({height:o+"px",top:d+"px"}),R.height=o,I.drawImage(x,C.position().left+2,d,C.width()+2,o,0,0,C.width(),o));break;case"b-resize":o=n,d<=r-4&&p<o&&(C.css("height",o+"px"),R.height=o,I.drawImage(x,C.position().left+2,C.position().top+2,C.width(),o,0,0,C.width(),o));break;case"lt-resize":h=C.width()-a,o=C.height()-n,M?0<=s&&c<h&&(o=h/v.ratio,0<=(d=i.topHeight-o)&&d<=u.height-o-4&&p<o&&(C.css({width:h+"px",height:o+"px",left:s+"px",top:d+"px"}),R.width=h,R.height=o,I.drawImage(x,s+2,d+2,h,o,0,0,h,o))):(0<=s&&c<h&&(C.css({width:h+"px",left:s+"px"}),R.width=h,I.drawImage(x,s+2,C.position().top+2,h,C.height(),0,0,h,C.height())),0<=d&&p<o&&(C.css({height:o+"px",top:d+"px"}),R.height=o,I.drawImage(x,C.position().left+2,d+2,C.width(),o,0,0,C.width(),o)));break;case"lb-resize":h=C.width()-a,o=n,M?0<=s&&c<h&&(o=h/v.ratio,d<=r-4&&p<o&&o<u.height-C.position().top-4&&(C.css({width:h+"px",height:o+"px",left:s+"px"}),R.width=h,R.height=o,I.drawImage(x,s+2,C.position().top+2,h,o,0,0,h,o))):(0<=s&&c<h&&(C.css({width:h+"px",left:s+"px"}),R.width=h,I.drawImage(x,s+2,C.position().top+2,h,C.height(),0,0,h,C.height())),d<=r-4&&p<o&&(C.css("height",o+"px"),R.height=o,I.drawImage(x,C.position().left+2,C.position().top+2,C.width(),o,0,0,C.width(),o)));break;case"rt-resize":h=a,o=C.height()-n,M?s<=g-4&&c<h&&(o=h/v.ratio,0<=(d=i.topHeight-o)&&p<o&&(C.css({width:h+"px",height:o+"px",top:d+"px"}),R.width=h,R.height=o,I.drawImage(x,C.position().left+2,d+2,h,o,0,0,h,o)),i.lastLeft=s):(s<=g-4&&c<h&&(C.css("width",h+"px"),R.width=h,I.drawImage(x,C.position().left+2,C.position().top+2,h,C.height(),0,0,h,C.height())),0<=d&&p<o&&(C.css({height:o+"px",top:d+"px"}),R.height=o,I.drawImage(x,C.position().left+2,d+2,C.width(),o,0,0,C.width(),o)));break;case"rb-resize":h=a,o=n,M?s<=g-4&&c<h&&(o=h/v.ratio,d<=r-4&&p<o&&o<u.height-C.position().top-4&&(C.css({width:h+"px",height:o+"px"}),R.width=h,R.height=o,I.drawImage(x,C.position().left+2,C.position().top+2,h,o,0,0,h,o))):(s<=g-4&&c<h&&(C.css("width",h+"px"),R.width=h,I.drawImage(x,C.position().left+2,C.position().top+2,h,C.height(),0,0,h,C.height())),d<=r-4&&p<o&&(C.css("height",o+"px"),R.height=o,I.drawImage(x,C.position().left+2,C.position().top+2,C.width(),o,0,0,C.width(),o)))}}function f(){i=!1,e={},h={}}b.drawImage(y,0,0,u.width,u.height),k.css({left:u.left,top:u.top,width:u.width,height:u.height}),I.drawImage(x,t.left+2,t.top+2,t.width,t.height,0,0,t.width,t.height),C.mousedown(function(t){i||(e.t=C,e.x=t.pageX-C.position().left,e.y=t.pageY-C.position().top),s=u.width-C.width(),d=u.height-C.height()}).dblclick(function(t){H.zoomable&&(1==m&&(o=!0),m>H.zoomMax-.5&&(o=!1),e.ox=Math.floor(t.pageX-W.offset().left),e.oy=Math.floor(t.pageY-W.offset().top),function(t){b.clearRect(0,0,l.width,l.height),t&&m<H.zoomMax?m++:1<m&&m--;l.width=u.width*m,l.height=u.height*m,w=m-(1<m?m/2:0),l.left=1<m?-e.ox*w:0,l.top=1<m?-e.oy*w:0,b.drawImage(y,l.left,l.top,l.width,l.height),I.drawImage(x,C.position().left+2,C.position().top+2,C.width(),C.height(),0,0,C.width(),C.height())}(o))}).touchstart(function(t){i||(e.t=C,e.x=t.originalEvent.touches[0].clientX-C.position().left,e.y=t.originalEvent.touches[0].clientY-C.position().top),s=u.width-C.width(),d=u.height-C.height()}),E.mousedown(function(t){i=!0,h.t=X(this),h.topHeight=C.position().top+C.height()}),X(document).mouseup(function(){f()}).mousemove(function(t){t.preventDefault(),!Y&&h.t&&n(t,h)}).touchend(function(){f()}),k.mousemove(function(t){t.preventDefault(),e.t&&a(t,e)}).touchmove(function(t){t.preventDefault(),e.t?a(t,e,!0):h.t&&(h.x||h.y)&&n(t,h,!0)}),X(H.btnDoneAttr).click(function(){z(R.toDataURL("image/jpeg"))})})})})},y.src=i}:console.log("JQuery 2.0.0 plugin undefined"),X.fn.extend({touchend:function(t){return t?this.bind("touchend",t):this.trigger("touchend")},touchstart:function(t){return t?this.bind("touchstart",t):this.trigger("touchstart")},touchmove:function(t){return t?this.bind("touchmove",t):this.trigger("touchmove")}})}($||jquery);